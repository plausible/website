<div class="bg-gray-100 overflow-x-hidden" id="pricing">
  <div class="pt-12 sm:pt-16 lg:pt-20">
    <div class="px-4 mx-auto max-w-screen-xl sm:px-6 lg:px-8">
      <div class="text-center">
        <h2
          class="text-3xl font-extrabold text-gray-900 leading-9 sm:text-4xl sm:leading-10 lg:text-5xl lg:leading-none">
          Traffic based plans that match your growth
        </h2>
        <p class="mt-4 text-xl text-gray-600 leading-7">
          Sign up for 30-day free trial. No credit card required.
        </p>
      </div>
    </div>
  </div>

  <script>
    const volumesWithPrices = [
      { volume: "10k", starter: 9, growth: 14, business: 19 },
      { volume: "100k", starter: 19, growth: 29, business: 39 },
      { volume: "200k", starter: 29, growth: 44, business: 59 },
      { volume: "500k", starter: 49, growth: 74, business: 99 },
      { volume: "1M", starter: 69, growth: 104, business: 139 },
      { volume: "2M", starter: 89, growth: 134, business: 179 },
      { volume: "5M", starter: 129, growth: 194, business: 259 },
      { volume: "10M", starter: 169, growth: 254, business: 339 },
    ]

    function volume(index) {
      index = parseInt(index)
      if (index === volumesWithPrices.length) {
        return "10M+"
      } else {
        return volumesWithPrices[index].volume
      }
    }

    function price(currency, index, tier, yearlyBilling, withoutDiscount = false) {
      index = parseInt(index)
      if (index === volumesWithPrices.length) {
        return "Custom"
      }

      let price

      if (yearlyBilling && withoutDiscount) {
        price = volumesWithPrices[index][tier] * 12
      } else if (yearlyBilling) {
        price = volumesWithPrices[index][tier] * 10
      } else {
        price = volumesWithPrices[index][tier]
      }

      return currency + price.toLocaleString("en-US")
    }

    function calculateBubblePosition(volumeIndex) {
      const range = document.getElementById("volume")
      const newVal = Number((volumeIndex / range.max) * 100)
      return `left: calc(${newVal}% + (${13.87 - newVal * 0.26}px))`
    }
  </script>
  <div class="mx-auto max-w-screen-xl mt-12 p-4" x-data="{yearlyBilling: false, volumeIndex: 0, currency: '$'}"
    x-init="fetch('/api/paddle/currency').then(response => response.json()).then(data => currency = data.currency)">
    <div class="flex flex-col gap-4 lg:flex-row lg:gap-8 items-center lg:items-baseline">
      <div class="lg:flex-1 lg:order-3 lg:justify-end flex">
        <div class="relative">
          <span
            class="absolute whitespace-no-wrap w-max px-2.5 py-0.5 rounded-full text-xs font-medium leading-4 bg-yellow-100 border border-yellow-300 text-yellow-700"
            style="right: -20px; top: -15px;">
            2 months free
          </span>
          <div
            class="grid grid-cols-2 gap-x-1 rounded-full bg-white p-1 text-center text-sm font-semibold leading-5 border border-gray-200">
            <label class="cursor-pointer rounded-full px-2.5 py-1 transition-colors ease-in-out duration-200"
              :class="yearlyBilling ? 'text-gray-900 bg-white' : 'text-white bg-indigo-600'"
              @click="yearlyBilling = false">
              <input type="radio" name="frequency" value="monthly" class="sr-only" />
              <span>Monthly</span>
            </label>
            <label class="cursor-pointer rounded-full px-2.5 py-1 transition-colors ease-in-out duration-200"
              :class="yearlyBilling ? 'text-white bg-indigo-600' : 'text-gray-900 bg-white'"
              @click="yearlyBilling = true">
              <input type="radio" name="frequency" value="yearly" class="sr-only" />
              <span>Yearly</span>
            </label>
          </div>
        </div>
      </div>
      <p class="lg:w-1/4 lg:order-1 font-medium text-gray-600">
        <span x-show="volumeIndex < volumesWithPrices.length">Up to</span>
        <b class="text-gray-900" x-text="volume(volumeIndex)"></b>
        <span>monthly pageviews</span>
      </p>
      <div class="max-w-md lg:max-w-none w-full mt-6 lg:w-1/2 lg:order-2 flex items-baseline space-x-2">
        <span class="text-xs font-medium text-gray-600">10k</span>
        <div class="flex-1 relative">
          <input id="volume" class="shadow w-full" type="range" min="0" max="8" step="1" x-model="volumeIndex" />
          <output class="bubble text-xs font-medium" x-text="volume(volumeIndex)"
            x-bind:style="`${calculateBubblePosition(volumeIndex)}`" />
        </div>
        <span class="text-xs font-medium text-gray-600">10M+</span>
      </div>
    </div>
    <div class="mt-6 overflow isolate mx-auto grid max-w-md grid-cols-1 gap-4 lg:mx-0 lg:max-w-none lg:grid-cols-4">
      {% for plan in site.data.plans %}
      <div class="rounded-xl px-4 py-4 bg-white border border-gray-200 shadow-md">
        <h3 class="text-lg font-semibold leading-8 text-gray-900">{{ plan.title }}</h3>
        <p class="mt-4 flex items-baseline gap-x-1">
          {% if plan.tier == "enterprise" %}
          <span class="text-4xl font-bold tracking-tight text-gray-900">Custom</span>
          {% else %}
          <span class="text-2xl font-bold w-max tracking-tight line-through text-gray-500 mr-1"
            x-show="yearlyBilling && volumeIndex < volumesWithPrices.length"
            x-html="price(currency, volumeIndex, '{{ plan.tier }}', yearlyBilling, withoutDiscount = true)"></span>
          <span class="text-4xl font-bold tracking-tight text-gray-900"
            x-html="price(currency, volumeIndex, '{{ plan.tier }}', yearlyBilling)"></span>
          <span class="text-sm font-semibold leading-6 text-gray-600" x-show="volumeIndex < volumesWithPrices.length"
            x-text="yearlyBilling && '/year' || '/month'">
          </span>
          {% endif %}
        </p>
        <a :href="volumeIndex < volumesWithPrices.length && '{{ plan.cta_link_path }}' || '/contact'"
          x-text="volumeIndex < volumesWithPrices.length && '{{ plan.cta_text }}' || 'Contact us'"
          class="mt-4 block rounded-md py-2 px-3 text-center text-sm font-semibold leading-6 bg-indigo-600 hover:bg-indigo-500 text-white transition duration-150 ease-in-out">
        </a>
        <ul class="mt-6 space-y-1 text-xs text-gray-600">
          {% for benefit in plan.benefits %}
          <li class="flex gap-x-3">
            <svg class="h-6 w-5 flex-none text-indigo-600" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path fill-rule="evenodd" clip-rule="evenodd"
                d="M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z" />
            </svg>
            {{ benefit }}
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endfor %}
    </div>
  </div>
</div>